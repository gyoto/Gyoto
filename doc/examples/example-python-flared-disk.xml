<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<Scenery>

  The goal of this example is to show how to implement a custom
  astrobj using the Python language directly in an XML file.

  <Metric kind = "KerrBL">
    <Mass unit="sunmass"> 4e6 </Mass>
    <Spin> 0.52 </Spin>
  </Metric>

  <Screen>
    <Distance unit="kpc"> 8 </Distance>
    <Inclination unit="degree"> 90 </Inclination>
    <PALN unit="degree"> 180 </PALN> 
    <Time unit="kpc"> 8 </Time>
    <FieldOfView unit="microas"> 200 </FieldOfView>
    <Resolution> 32 </Resolution>
    <Spectrometer kind="wave" nsamples="1"> 2.0e-6 2.4e-6 </Spectrometer>
  </Screen>

  <Astrobj kind = "Python::Standard" plugin="fallback:python3">

    We specify python3 as a "fallback" plug-in as the python plug-in
    can be compiled for several versions of Python. If loading this
    file from Python, the right python plug-in should have been loaded
    already. When loading this file from the gyoto command-line tool,
    if the python3 plg-in cannot be loaded, try with a name that
    matches your Python interpreter, for instance :
      gyoto -pstdplug,python3.14 input.xml output.xml

    <RMax> 50 </RMax>

    <CriticalValue>0.</CriticalValue>
    <SafetyValue>0.3</SafetyValue>

    <OpticallyThin/>
    <InlineModule>
        import math
        class FlaredDisk:
            opening=0.2
            rin=4
            rout=15
            def __call__(self, coord):
                r=math.sin(coord[2])*coord[1]
                h_r=abs(math.cos(coord[2]))
                return max(h_r-self.opening, self.rin-r, r-self.rout)
            def getVelocity(self, coord, vel):
                self.this.metric().circularVelocity(coord, vel)
    </InlineModule>
    <Class>FlaredDisk</Class>
  </Astrobj>

  <Quantities>Intensity</Quantities>

</Scenery>
